<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detector de Llamaradas Solares</title>
    <!-- Favicon - Reemplaza 'logo.png' con la ruta de tu imagen -->
    <link rel="icon" type="image/png" href="/static/images/ICN-logo.png">
    <link rel="shortcut icon" type="image/png" href="/static/images/ICN-logo.png">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 100px auto 20px auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1em;
        }

        .upload-section {
            padding: 40px;
            background: #f8f9fa;
        }

        .upload-zone {
            border: 3px dashed #667eea;
            border-radius: 15px;
            padding: 60px 20px;
            text-align: center;
            background: white;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .upload-zone:hover {
            background: #f0f4ff;
            border-color: #764ba2;
        }

        .upload-zone.dragover {
            background: #e8ecff;
            border-color: #764ba2;
            transform: scale(1.02);
        }

        .upload-icon {
            font-size: 4em;
            margin-bottom: 20px;
        }

        .file-input {
            display: none;
        }

        /* Selector de Tarea */
        .task-selector {
            margin: 30px 0;
            padding: 20px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .task-selector h3 {
            color: #667eea;
            margin-bottom: 15px;
            text-align: center;
        }

        .task-options {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .task-option {
            flex: 1;
            min-width: 250px;
            padding: 20px;
            border: 2px solid #667eea;
            border-radius: 10px;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .task-option:hover {
            background: #f0f4ff;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.2);
        }

        .task-option.selected {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #764ba2;
        }

        .task-option .task-title {
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .task-option .task-description {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .wavelength-selector {
            margin: 20px 0;
            display: flex;
            gap: 20px;
            justify-content: center;
        }

        .wavelength-option {
            padding: 15px 30px;
            border: 2px solid #667eea;
            border-radius: 10px;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.1em;
        }

        .wavelength-option:hover {
            background: #f0f4ff;
        }

        .wavelength-option.selected {
            background: #667eea;
            color: white;
        }

        .btn {
            padding: 15px 40px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.1em;
            cursor: pointer;
            transition: transform 0.3s ease;
            margin: 20px auto;
            display: block;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .results-section {
            padding: 40px;
            display: none;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 30px;
            margin-top: 30px;
        }

        .image-card {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .image-card-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            font-size: 1.2em;
            font-weight: bold;
        }

        .image-container {
            position: relative;
            background: #f8f9fa;
            min-height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .image-container img {
            max-width: 100%;
            height: auto;
            display: block;
        }

        .predictions {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-top: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .predictions h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .prediction-item {
            display: flex;
            justify-content: space-between;
            padding: 12px;
            margin: 10px 0;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .prediction-class {
            font-weight: bold;
            color: #333;
        }

        .prediction-confidence {
            color: #667eea;
            font-weight: bold;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 40px;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error {
            background: #ff4757;
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            display: none;
        }

        .success {
            background: #00d68f;
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            display: none;
        }

        .analysis-box {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-top: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .analysis-box h3 {
            color: #764ba2;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .alert-normal {
            background: #00d68f20;
            border-left: 4px solid #00d68f;
            color: #00b074;
        }

        .alert-warning {
            background: #ffa50020;
            border-left: 4px solid #ffa500;
            color: #ff8c00;
        }

        .alert-danger {
            background: #ff475720;
            border-left: 4px solid #ff4757;
            color: #ff4757;
        }

        .alert-message {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-weight: bold;
        }

        .task-badge {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.9em;
            background: #667eea;
            color: white;
            margin-left: 10px;
        }

        @media (max-width: 768px) {
            .results-grid {
                grid-template-columns: 1fr;
            }
            
            .task-options {
                flex-direction: column;
            }
            
            .header h1 {
                font-size: 1.8em;
            }
            
            .wavelength-selector {
                flex-direction: column;
            }
        }

        /* Barra superior fija */
        .top-bar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 80px;
            background: rgba(255, 255, 255, 0.98);
            box-shadow: 0 2px 15px rgba(0, 0, 0, 0.1);
            z-index: 2001;
            display: flex;
            align-items: center;
            padding: 0 20px;
            gap: 15px;
        }
        
        /* Logo del hackaton */
        .hackaton-logo {
            width: 60px;
            height: 60px;
            flex-shrink: 0;
        }
        
        .hackaton-logo img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        
        /* Título */
        .header-title {
            flex-shrink: 0;
        }
        
        .header-title h2 {
            color: #667eea;
            font-size: 1.8rem;
            font-weight: bold;
            margin: 0;
            letter-spacing: 0.5px;
        }
        


        .header-title h2 {
            color: #667eea;
            font-size: 1.8rem;
            font-weight: bold;
            margin: 0;
            letter-spacing: 0.5px;
        }

        /* Contenedor del QR */
        .qr-container {
            position: fixed;
            bottom: 80px;
            left: 20px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            text-align: center;
            z-index: 2000;
            transition: all 0.3s ease;
        }

        .qr-toggle-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            font-size: 0.95rem;
            width: 100%;
            transition: all 0.3s ease;
        }

        .qr-toggle-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .qr-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease, padding 0.3s ease;
            padding: 0 20px;
        }

        .qr-content.open {
            max-height: 500px;
            padding: 20px;
        }

        .qr-title {
            color: #667eea;
            font-size: 1.1rem;
            font-weight: bold;
            margin-bottom: 15px;
        }

        .qr-code {
            width: 180px;
            height: 180px;
            margin: 0 auto 15px;
            background: white;
            border: 3px solid #667eea;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .qr-code img {
            width: 100%;
            height: 100%;
            border-radius: 8px;
        }

        .qr-footer {
            color: #764ba2;
            font-size: 0.85rem;
            font-weight: 600;
            line-height: 1.4;
            margin-top: 10px;
        }

        .qr-footer .separator {
            color: #667eea;
            margin: 0 5px;
        }

        /* Contenedor del equipo */
        .team-container {
            position: fixed;
            bottom: 80px;
            right: 20px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            z-index: 2000;
            max-width: 400px;
            max-height: calc(100vh - 180px);
            transition: all 0.3s ease;
        }

        .team-toggle-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            font-size: 0.95rem;
            width: 100%;
            transition: all 0.3s ease;
        }

        .team-toggle-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .team-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease, padding 0.3s ease;
            padding: 0 25px;
        }

        .team-content.open {
            max-height: 500px;
            padding: 25px;
            overflow-y: auto;
        }

        .team-title {
            color: #667eea;
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
            border-bottom: 2px solid #764ba2;
            padding-bottom: 10px;
        }

        .team-member {
            margin-bottom: 12px;
            padding: 8px;
            border-radius: 8px;
            transition: background 0.3s ease;
        }

        .team-member:hover {
            background: rgba(102, 126, 234, 0.1);
        }

        .member-name {
            color: #764ba2;
            font-weight: 600;
            font-size: 0.95rem;
            margin-bottom: 3px;
        }

        .member-email {
            color: #667eea;
            font-size: 0.85rem;
            word-break: break-all;
        }

        /* Footer */
        .footer-info {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.85);
            padding: 12px 20px;
            text-align: center;
            z-index: 1999;
        }

        .event-info {
            color: rgba(255, 255, 255, 0.9);
            font-size: 0.95rem;
            font-weight: 500;
        }

        .event-info .separator {
            margin: 0 10px;
            color: #667eea;
        }

    
        /* Menú lateral derecho */
        .side-menu {
            position: fixed;
            right: 0;
            top: 50%;
            transform: translateY(-50%);
            z-index: 2000;
            display: flex;
            flex-direction: column;
            gap: 15px;
            padding-right: 20px;
        }

        .menu-button {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2rem;
            color: white;
            overflow: hidden;
        }

        .menu-button:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
        }


        .github-btn {
            background: #24292e;
            position: relative;
        }

        .github-btn::before {
            content: "";
            position: absolute;
            width: 30px;
            height: 30px;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24" fill="white"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg>');
            background-size: contain;
        }

        .qr-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .team-btn {
            background: white;
            padding: 5px;
        }

        .team-btn img {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            object-fit: cover;
        }

        /* Panel deslizable QR */
        .qr-panel {
            position: fixed;
            right: -450px;
            top: 50%;
            transform: translateY(-50%);
            width: 400px;
            background: white;
            border-radius: 15px 0 0 15px;
            box-shadow: -5px 0 25px rgba(0, 0, 0, 0.3);
            z-index: 1999;
            transition: right 0.4s ease;
            padding: 30px;
        }

        .qr-panel.open {
            right: 0;
        }

        /* Panel deslizable Equipo */
        .team-panel {
            position: fixed;
            right: -450px;
            top: 50%;
            transform: translateY(-50%);
            width: 400px;
            max-height: 80vh;
            background: white;
            border-radius: 15px 0 0 15px;
            box-shadow: -5px 0 25px rgba(0, 0, 0, 0.3);
            z-index: 1999;
            transition: right 0.4s ease;
            padding: 30px;
            overflow-y: auto;
        }

        .team-panel.open {
            right: 0;
        }

        .panel-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: #764ba2;
            color: white;
            border: none;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .panel-close:hover {
            background: #667eea;
            transform: rotate(90deg);
        }

        .panel-title {
            color: #667eea;
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 3px solid #764ba2;
        }

        /* Remover estilos antiguos del QR y equipo */
        .qr-container {
            display: none;
        }

        .team-container {
            display: none;
        }


        /* Input de nombre de archivo */
        .file-name-input {
            margin-top: 20px;
            padding: 15px;
            background: white;
            border-radius: 10px;
            border: 2px solid #667eea;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .file-name-input label {
            display: block;
            color: #667eea;
            font-weight: bold;
            margin-bottom: 8px;
            font-size: 1rem;
        }

        .file-name-input input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .file-name-input input:focus {
            outline: none;
            border-color: #667eea;
        }

        .file-name-input small {
            display: block;
            margin-top: 5px;
            color: #666;
            font-size: 0.85rem;
        }

        /* Responsive del menú lateral */
        @media (max-width: 768px) {
            .top-bar {
                height: 70px;
                padding: 0 10px;
            }
            
            .hackaton-logo {
                width: 50px;
                height: 50px;
            }
            
            .header-title h2 {
                font-size: 1.3rem;
            }
            
            .container {
                margin-top: 85px;
            }
            
            .side-menu {
                padding-right: 10px;
            }

            .menu-button {
                width: 50px;
                height: 50px;
                font-size: 1rem;
            }

            .qr-panel,
            .team-panel {
                width: 90vw;
                right: -95vw;
                border-radius: 15px 0 0 15px;
            }
        }
</style>
</head>
<body>
    <!-- Barra superior fija -->
    <div class="top-bar">
        <div class="hackaton-logo">
            <img src="/static/images/logo_hackaton.png" alt="Logo Hackaton">
        </div>
        <div class="header-title">
            <h2>HackICN+Bravos 2025</h2>
        </div>
    </div>

    <!-- Menú lateral derecho -->
    <div class="side-menu">
        <button class="menu-button qr-btn" onclick="openQRPanel()" title="Código QR">
            QR
        </button>
        <button class="menu-button team-btn" onclick="openTeamPanel()" title="Nuestro Equipo">
            <img src="/static/images/ICN-logo.png" alt="Equipo">
        </button>
        <a href="https://github.com/MonkeyDMemo/hackatonLlamaradas.git" target="_blank" class="menu-button github-btn" title="GitHub Repository"></a>
    </div>

    <!-- Panel QR -->
    <div class="qr-panel" id="qrPanel">
        <button class="panel-close" onclick="closeQRPanel()">×</button>
        <div class="panel-title">¡Ingresa porfavor!!!</div>
        <div class="qr-code">
            <img src="/static/images/mi_qr.png" alt="Código QR">
        </div>
        <div class="qr-footer">
            Instituto de Ciencias Nucleares
            <span class="separator">|</span>
            HackICN+Bravos 2025
        </div>
    </div>

    <!-- Panel Equipo -->
    <div class="team-panel" id="teamPanel">
        <button class="panel-close" onclick="closeTeamPanel()">×</button>
        <div class="panel-title">Nuestro Equipo</div>
        
        <div class="team-member">
            <div class="member-name">Antonio Arturo Miranda Rosete</div>
            <div class="member-email">arturo.miranda@correo.nucleares.unam.mx</div>
        </div>

        <div class="team-member">
            <div class="member-name">Aldo Vladimir Román Díaz</div>
            <div class="member-email">aldo.vladimir.roman@gmail.com</div>
        </div>

        <div class="team-member">
            <div class="member-name">Sydney Paola Montiel Mondaca</div>
            <div class="member-email">smontielm2001@alumno.ipn.mx</div>
        </div>

        <div class="team-member">
            <div class="member-name">Juan Guillermo Resendiz Rojas</div>
            <div class="member-email">memoresendiz69@gmail.com</div>
        </div>

        <div class="team-member">
            <div class="member-name">Julieta Zaldívar Gómez</div>
            <div class="member-email">al2233001764@azc.uam.mx</div>
        </div>
    </div>

    <!-- Footer -->
    <div class="footer-info">
        <a href="https://github.com/MonkeyDMemo/hackatonLlamaradas.git" target="_blank" class="repo-link">
            GitHub: github.com/MonkeyDMemo/hackatonLlamaradas
        </a>
        <div class="event-info">
            26 de Octubre, 2025
            <span class="separator">•</span>
            Instituto de Ciencias Nucleares, UNAM
        </div>
    </div>


    <div class="container">
        <div class="header">
            <h1>☀️ Detector de Ráfagas Solares</h1>
            <p>Análisis con IA - Selecciona la tarea a ejecutar</p>
        </div>

        <div class="upload-section">
            <!-- Selector de Tarea -->
            <div class="task-selector">
                <!--<h3>Selecciona la Tarea de Análisis</h3>-->
                <div class="task-options">
                    <div class="task-option selected" data-task="1">
                        <div class="task-title">Task 1</div>
                        <div class="task-description">
                            <strong>Clasificación de Ráfagas</strong><br>
                            Identifica la presencia de una ráfaga en una imagen del Sol
                        </div>
                    </div>
                    <div class="task-option" data-task="2">
                        <div class="task-title">Task 2</div>
                        <div class="task-description">
                            <strong>Predicción de Ráfagas</strong><br>
                            Predice si ocurrirá una ráfaga a partir de una imagen del Sol
                        </div>
                    </div>
                </div>
            </div>

            <div class="upload-zone" id="uploadZone">
                <div class="upload-icon">📁</div>
                <h2>Arrastra tu imagen aquí</h2>
                <p>o haz clic para seleccionar</p>
                <p style="margin-top: 10px; opacity: 0.7; font-size: 0.9em;">
                    Formatos aceptados: TIFF, TIF
                </p>
                <input type="file" id="fileInput" class="file-input" accept="image/*,.tif,.tiff">
            </div>

            <div class="wavelength-selector">
                <div class="wavelength-option selected" data-wavelength="131">
                    ☀️ 131 Å
                </div>
                <div class="wavelength-option" data-wavelength="193">
                    🌟 193 Å
                </div>
            </div>

            <!-- Input para nombre de archivo -->
            <div class="file-name-input" style="margin: 20px 0;">
                <label for="fileNameInput" style="display: block; color: #667eea; font-weight: bold; margin-bottom: 8px;">
                    Nombre del archivo (opcional):
                </label>
                <input type="text" id="fileNameInput" placeholder="Escribe el nombre del archivo aquí..." 
                       style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 1rem;">
                <small style="display: block; margin-top: 5px; color: #666; font-size: 0.85rem;">
                    También puedes usar drag & drop o seleccionar desde tu computadora
                </small>
            </div>

            <button class="btn" id="processBtn" disabled>Procesar Imagen</button>

            <div class="error" id="errorMsg"></div>
            <div class="success" id="successMsg"></div>
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>Procesando imagen...</p>
            </div>
        </div>

        <div class="results-section" id="resultsSection">
            <h2 style="text-align: center; color: #667eea; margin-bottom: 20px;">
                Resultados
            </h2>

            <div class="results-grid">
                <div class="image-card">
                    <div class="image-card-header">Imagen Original</div>
                    <div class="image-container" id="originalImage">
                        <p>Cargando...</p>
                    </div>
                </div>

                <div class="image-card">
                    <div class="image-card-header">Eliminación de Flat</div>
                    <div class="image-container" id="processedImage">
                        <p>Cargando...</p>
                    </div>
                </div>

                <div class="image-card">
                    <div class="image-card-header">Inferencia</div>
                    <div class="image-container" id="annotatedImage">
                        <p>Cargando...</p>
                    </div>
                </div>
            </div>

            <div class="predictions" id="predictionsContainer">
                <h3>Predicciones del Modelo</h3>
                <div id="predictionsList"></div>
            </div>

            <div class="analysis-box" id="analysisBox" style="display: none;">
                <h3>Análisis de Resultados</h3>
                <div id="analysisContent">
                    <!-- Se llena dinámicamente -->
                </div>
            </div>
        </div>
    </div>

    <script>
        const uploadZone = document.getElementById('uploadZone');
        const fileInput = document.getElementById('fileInput');
        const processBtn = document.getElementById('processBtn');
        const loading = document.getElementById('loading');
        const errorMsg = document.getElementById('errorMsg');
        const successMsg = document.getElementById('successMsg');
        const resultsSection = document.getElementById('resultsSection');
        
        let selectedFile = null;
        let selectedWavelength = '131';
        let selectedTask = '1';

        // Selector de tarea
        document.querySelectorAll('.task-option').forEach(option => {
            option.addEventListener('click', () => {
                document.querySelectorAll('.task-option').forEach(o => 
                    o.classList.remove('selected'));
                option.classList.add('selected');
                selectedTask = option.dataset.task;
                console.log('Tarea seleccionada:', selectedTask);
            });
        });

        // Manejo de carga de archivos
        uploadZone.addEventListener('click', () => fileInput.click());
        
        uploadZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadZone.classList.add('dragover');
        });
        
        uploadZone.addEventListener('dragleave', () => {
            uploadZone.classList.remove('dragover');
        });
        
        uploadZone.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadZone.classList.remove('dragover');
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFile(files[0]);
            }
        });
        
        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleFile(e.target.files[0]);
            }
        });
        
        function handleFile(file) {
            selectedFile = file;
            
            // Actualizar el input de texto con el nombre del archivo
            const fileNameInput = document.getElementById('fileNameInput');
            if (fileNameInput) {
                fileNameInput.value = file.name;
            }
            

            // Detectar tipo por nombre
            const filename = file.name.toLowerCase();
            let detectedType = 'No detectado';
            
            if (filename.includes('_0131') || filename.includes('131')) {
                detectedType = '131 Å';
                document.querySelectorAll('.wavelength-option').forEach(o => 
                    o.classList.remove('selected'));
                document.querySelector('[data-wavelength="131"]').classList.add('selected');
                selectedWavelength = '131';
            } else if (filename.includes('_0193') || filename.includes('193')) {
                detectedType = '193 Å';
                document.querySelectorAll('.wavelength-option').forEach(o => 
                    o.classList.remove('selected'));
                document.querySelector('[data-wavelength="193"]').classList.add('selected');
                selectedWavelength = '193';
            }
            
            uploadZone.innerHTML = `
                <div class="upload-icon">✅</div>
                <h2>${file.name}</h2>
                <p>Tamaño: ${(file.size / 1024 / 1024).toFixed(2)} MB</p>
                <p style="color: #667eea; font-weight: bold;">Tipo detectado: ${detectedType}</p>
                <p style="margin-top: 10px; opacity: 0.7;">Clic para cambiar archivo</p>
            `;
            processBtn.disabled = false;
        }
        
        // Selector de longitud de onda
        document.querySelectorAll('.wavelength-option').forEach(option => {
            option.addEventListener('click', () => {
                document.querySelectorAll('.wavelength-option').forEach(o => 
                    o.classList.remove('selected'));
                option.classList.add('selected');
                selectedWavelength = option.dataset.wavelength;
            });
        });
        
        // Procesar imagen
        processBtn.addEventListener('click', async () => {
            if (!selectedFile) return;
            
            const filename = selectedFile.name.toLowerCase();
            let detectedWavelength = selectedWavelength;
            
            if (filename.includes('_0131') || filename.includes('131')) {
                detectedWavelength = '131';
            } else if (filename.includes('_0193') || filename.includes('193')) {
                detectedWavelength = '193';
            }
            
            const formData = new FormData();
            formData.append('file', selectedFile);
            formData.append('wavelength', detectedWavelength);
            formData.append('task', selectedTask);
            
            // Mostrar loading con información
            const taskName = selectedTask === '1' ? 'Clasificación' : 'Probabilidad';
            loading.innerHTML = `
                <div class="spinner"></div>
                <p>Procesando imagen...</p>
                <p style="opacity: 0.7; font-size: 0.9em;">
                    Tipo: ${detectedWavelength} Å | Task ${selectedTask}: ${taskName}
                </p>
            `;
            loading.style.display = 'block';
            errorMsg.style.display = 'none';
            successMsg.style.display = 'none';
            resultsSection.style.display = 'none';
            processBtn.disabled = true;
            
            try {
                const response = await fetch('/upload', {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showResults(data);
                    successMsg.innerHTML = `
                        ✅ Imagen procesada exitosamente<br>
                        <small>Longitud de onda: ${data.wavelength} Å | 
                        Task ${data.task}: ${data.analysis.task_name}</small>
                    `;
                    successMsg.style.display = 'block';
                } else {
                    throw new Error(data.error || 'Error desconocido');
                }
            } catch (error) {
                errorMsg.textContent = `❌ Error: ${error.message}`;
                errorMsg.style.display = 'block';
                console.error('Error:', error);
            } finally {
                loading.style.display = 'none';
                processBtn.disabled = false;
            }
        });
        
        function showResults(data) {
            resultsSection.style.display = 'block';
            
            // Mostrar imágenes
            document.getElementById('originalImage').innerHTML = 
                `<img src="${data.original}" alt="Original">`;
            document.getElementById('processedImage').innerHTML = 
                `<img src="${data.processed}" alt="Procesada">`;
            document.getElementById('annotatedImage').innerHTML = 
                `<img src="${data.annotated}" alt="Anotada">`;
            
            // Mostrar predicciones
            const predictionsList = document.getElementById('predictionsList');
            if (data.predictions && data.predictions.length > 0) {
                predictionsList.innerHTML = data.predictions
                    .sort((a, b) => b.confidence - a.confidence)
                    .map(pred => `
                        <div class="prediction-item">
                            <span class="prediction-class">
                                ${pred.class}
                                <span class="task-badge">Task ${pred.task}</span>
                            </span>
                            <span class="prediction-confidence">
                                ${(pred.confidence * 100).toFixed(1)}%
                            </span>
                        </div>
                    `).join('');
            } else {
                predictionsList.innerHTML = 
                    '<p style="text-align: center; opacity: 0.7;">No se detectaron llamaradas</p>';
            }
            
            // Mostrar análisis
            if (data.analysis) {
                const analysisBox = document.getElementById('analysisBox');
                const analysisContent = document.getElementById('analysisContent');
                
                analysisBox.style.display = 'block';
                
                const alertClass = `alert-${data.analysis.alert_level}`;
                
                analysisContent.innerHTML = `
                    <div class="alert-message ${alertClass}">
                        ${data.analysis.analysis_message}
                    </div>
                    <div style="margin-top: 15px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                        <strong>📋 Tarea ejecutada:</strong> Task ${data.analysis.task} - ${data.analysis.task_name}<br>
                        <strong>📊 Modelo usado:</strong> ${data.analysis.model_used}<br>
                        <strong>📝 Descripción:</strong> ${data.analysis.task_description}
                    </div>
                `;
            }
            
            // Scroll suave hacia resultados
            resultsSection.scrollIntoView({ behavior: 'smooth' });
        }

        // Listener para el input de nombre de archivo
        const fileNameInput = document.getElementById('fileNameInput');
        if (fileNameInput) {
            fileNameInput.addEventListener('change', function(e) {
                const filename = e.target.value.trim();
                if (filename) {
                    console.log('Nombre de archivo ingresado:', filename);
                }
            });
        }

        // Verificar estado de imágenes de fondo al cargar
        window.addEventListener('load', async () => {
            try {
                const response = await fetch('/check_backgrounds');
                const data = await response.json();
                console.log('Estado de fondos:', data);
                
                if (!data.fondo_131.loaded || !data.fondo_193.loaded) {
                    console.warn('⚠️ Algunas imágenes de fondo no están cargadas');
                    
                    let missingBackgrounds = [];
                    if (!data.fondo_131.loaded) missingBackgrounds.push('131 Å');
                    if (!data.fondo_193.loaded) missingBackgrounds.push('193 Å');
                    
                    errorMsg.innerHTML = `
                        ⚠️ Advertencia: Imágenes de fondo no cargadas: ${missingBackgrounds.join(', ')}<br>
                        <small>Verifica las rutas en app.py</small>
                    `;
                    errorMsg.style.background = '#ff9f43';
                    errorMsg.style.display = 'block';
                }
            } catch (error) {
                console.error('Error verificando fondos:', error);
            }
        });
    </script>

    <script>
        function openQRPanel() {
            document.getElementById('qrPanel').classList.add('open');
            closeTeamPanel(); // Cerrar el otro panel
        }

        function closeQRPanel() {
            document.getElementById('qrPanel').classList.remove('open');
        }

        function openTeamPanel() {
            document.getElementById('teamPanel').classList.add('open');
            closeQRPanel(); // Cerrar el otro panel
        }

        function closeTeamPanel() {
            document.getElementById('teamPanel').classList.remove('open');
        }

        // Cerrar paneles al hacer clic fuera
        document.addEventListener('click', function(event) {
            const qrPanel = document.getElementById('qrPanel');
            const teamPanel = document.getElementById('teamPanel');
            const sideMenu = document.querySelector('.side-menu');
            
            if (!qrPanel.contains(event.target) && !sideMenu.contains(event.target)) {
                closeQRPanel();
            }
            if (!teamPanel.contains(event.target) && !sideMenu.contains(event.target)) {
                closeTeamPanel();
            }
        });
    </script>
</body>
</html>